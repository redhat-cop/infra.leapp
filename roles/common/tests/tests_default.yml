---
- name: Test
  hosts: all
  vars:
    job_name: test_common
  tasks:
    - name: Test | Run common
      block:
        - name: Test | Run role common
          ansible.builtin.include_role:
            name: infra.leapp.common
      rescue:
        - name: Test | Check error
          ansible.builtin.debug:
            msg: errors {{ ansible_failed_result | to_nice_json }}

        - name: Test | Ensure correct error
          vars:
            err_pat: You must run the role with tasks_from
          ansible.builtin.assert:
            that:
              - ansible_failed_result is defined
              - ansible_failed_result.msg is defined
              - ansible_failed_result.msg is search (err_pat)
      always:
        - name: Test | Include cleanup logs
          ansible.builtin.include_role:
            name: infra.leapp.common
            tasks_from: cleanup_logs.yml

...

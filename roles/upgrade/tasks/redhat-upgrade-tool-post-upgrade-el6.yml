---
- name: redhat-upgrade-tool-post-upgrade-el6 | Ensure redhat-upgrade-cmdline-instrepo.repo file is absent
  ansible.builtin.file:
    path: /etc/yum.repos.d/redhat-upgrade-cmdline-instrepo.repo
    state: absent

# Note: RHEL 6 does not support the rhc role - using subscription-manager directly.
- name: redhat-upgrade-tool-post-upgrade-el6 | Register with post-leapp Satellite activation key
  ansible.builtin.shell: >
    export PATH={{ leapp_os_path }};
    subscription-manager register
    --org="{{ leapp_satellite_organization }}"
    --activationkey="{{ leapp_satellite_activation_key_post_leapp }}"
    --force
  register: sub_man_reg
  when:
    - leapp_upgrade_type == 'satellite'
    - leapp_satellite_organization | default('') | length > 0
    - leapp_satellite_activation_key_post_leapp | default('') | length > 0
  failed_when: false
  changed_when: true

- name: redhat-upgrade-tool-post-upgrade-el6 | Include custom_local_repos for local_repos_post_upgrade
  vars:
    __repos: "{{ leapp_local_repos_post_upgrade }}"
  ansible.builtin.include_role:
    name: infra.leapp.common
    tasks_from: custom_local_repos
  when: leapp_upgrade_type == "custom"

- name: redhat-upgrade-tool-post-upgrade-el6 | Include handle-old-packages.yml
  ansible.builtin.include_tasks: handle-old-packages.yml

- name: redhat-upgrade-tool-post-upgrade-el6 | Include grub2-upgrade.yml
  ansible.builtin.include_tasks: grub2-upgrade.yml
  when:
    - ansible_facts["architecture"] == 'x86_64'
    - leapp_update_grub_to_grub_2

- name: redhat-upgrade-tool-post-upgrade-el6 | Include update-and-reboot.yml
  ansible.builtin.include_tasks: update-and-reboot.yml
...

# set up the test system to test removed kernel drivers remediation
# see KERNEL_MODULES.md for more details
---
- name: setup | remediate_removed_kernel_drivers | Set list of test kernel modules
  ansible.builtin.set_fact:
    leapp_test_kernel_modules: "{{ __test_modules.get(__platform, []) }}"
  vars:
    __platform: "{{ ansible_facts['os_family'] }}_{{ ansible_facts['distribution_major_version'] }}"
    __test_modules:
      RedHat_7:
        - 3w-9xxx
        - pata_acpi
        - tulip
      RedHat_8:
        - dnet
        - dlci
        - liquidio
      RedHat_9:
        - qla3xxx
        - vmw_pvrdma
- name: setup | remediate_removed_kernel_drivers | Load the test kernel modules
  ansible.builtin.include_role:
    name: infra.leapp.common
    tasks_from: manage_kernel_modules.yml
  vars:
    leapp_kernel_modules: "{{ leapp_test_kernel_modules }}"
    leapp_kernel_modules_state: present

...
